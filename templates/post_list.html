{% extends "base.html" %}

{% block title %}All Posts{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 700px;">
  <h2 class="mb-4 fw-bold">📝 All Posts</h2>

  {% for post in page_obj %}
    <div class="card mb-4 shadow-sm border border-light" style="border-radius: 14px;">
      <div class="card-body">
        <!-- User info -->
        <h6 class="mb-0 fw-semibold">{{ post.user.username }}</h6>
        <small class="text-muted">{{ post.created|timesince }} ago</small>

        <!-- Post body -->
        <p class="card-text mt-2" style="font-size: 1.05rem; line-height: 1.6;">
          {{ post.body }}
        </p>

        <!-- Media -->
        {% if post.media %}
          <div class="text-center mt-3">
            <img src="{{ post.media.url }}"
                 alt="Post media"
                 class="img-fluid rounded shadow-sm"
                 style="max-height: 450px; object-fit: cover;">
          </div>
        {% endif %}

        <!-- Actions: Like, Comment, Bookmark -->
        <div class="d-flex justify-content-start mt-3 gap-3 align-items-center">

          <!-- Like tugmasi -->
          <div class="action small like">
            <form action="{% url 'toggle_like' post.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-link p-0" style="color: {% if request.user in post.likes.all %}red{% else %}gray{% endif %};">
                    <i class="fa-solid fa-heart"></i> {{ post.total_likes }}
                </button>
            </form>
          </div>

          <!-- Comment tugmasi -->
          <div class="action small comment">
            <a href="{% url 'post_detail' post.id %}" class="btn btn-link p-0 text-muted">
              <i class="fa-regular fa-comment"></i> {{ post.comments.count }}
            </a>
          </div>

          <!-- Bookmark tugmasi -->
          <div class="action small bookmark">
            <a href="{% url 'toggle_bookmark' post.id %}" class="btn btn-sm btn-outline-primary">
              📑 Save
            </a>
          </div>

        </div>
      </div>
    </div>
  {% empty %}
    <div class="alert alert-info text-center p-4" style="border-radius: 14px;">
      📭 Hali hech qanday post yo‘q
    </div>
  {% endfor %}

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-4">
    <nav>
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
          </li>
        {% endif %}

        <li class="page-item disabled">
          <a class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</a>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</div>
{% endblock %}
